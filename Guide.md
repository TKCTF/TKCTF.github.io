# TKCTF 官网开发指南

## 📦 NPM 命令速查

### 1️⃣ 安装依赖
```bash
npm install
```

**依赖包说明：**
- `esbuild` - 快速构建打包工具
- `crypto-js` - 加密库（用于彩蛋内容）
- `http-server` - HTTP 测试服务器
- `chokidar` - 文件监听库（用于开发模式）

### 2️⃣ 开发模式（监听文件变化）
```bash
npm run dev
```
- 自动监听 `src/` 目录下的文件变化
- 实时重新构建到 `publish/` 目录
- 适合开发时使用

### 3️⃣ 生产构建
```bash
npm run build
```
- 一次性构建所有文件
- 压缩 JS/CSS 文件
- 输出到 `publish/` 目录

### 4️⃣ 启动本地测试服务器 
```bash
npm run start
```

**服务器配置：**
- 🌐 **访问地址**：`http://localhost:18980`
- 📁 **根目录**：`./publish`
- 🚫 **缓存策略**：完全禁用（`-c-1`）
- 🔓 **CORS**：已启用
- 🌍 **自动打开浏览器**：是（`-o`）
- 🔄 **智能端口管理**：自动清理占用端口的旧进程

**使用场景：**
- ✅ 测试构建后的网站
- ✅ 调试音频、视频等资源加载
- ✅ 验证 Web Worker 功能
- ✅ 测试跨域请求
- ✅ 模拟真实的生产环境

**智能特性：**
- 🎯 **自动端口清理**：启动前自动检测并清理 18980 端口
- 🛡️ **优雅退出**：`Ctrl+C` 停止时自动释放端口
- 🔄 **无缝重启**：无需手动查找并结束占用端口的进程
- 🖥️ **跨平台支持**：Windows、Linux、macOS 均可使用

**注意事项：**
- ⚠️ 使用前请先运行 `npm run build` 构建项目
- ⚠️ 服务器会禁用所有缓存，确保每次刷新都加载最新内容
- ⚠️ 修改代码后需要重新构建才能看到效果

## 🔄 推荐工作流

### 开发阶段
```bash
# 终端 1：启动监听模式
npm run dev

# 终端 2：启动测试服务器
npm run start
```

这样可以：
1. 修改代码后自动构建
2. 刷新浏览器即可看到最新效果
3. 无缓存保证每次都是最新版本

### 发布前测试
```bash
# 1. 构建生产版本
npm run build

# 2. 启动测试服务器
npm run start

# 3. 在浏览器中测试所有功能
```

## 🛠️ http-server 参数说明

当前使用的参数：
```bash
http-server ./publish -p 18980 -c-1 --cors -o
```

| 参数 | 说明 |
|------|------|
| `./publish` | 服务器根目录 |
| `-p 18980` | 端口号 18980 |
| `-c-1` | 禁用缓存（-1 表示无缓存） |
| `--cors` | 启用 CORS 跨域支持 |
| `-o` | 自动在默认浏览器中打开 |

其他可用参数（如需修改 `package.json`）：
- `-a 127.0.0.1` - 指定监听地址
- `-d false` - 禁用目录列表
- `-g` 或 `--gzip` - 启用 gzip 压缩
- `-S` 或 `--ssl` - 启用 HTTPS
- `--proxy` - 设置代理

## 📝 常见问题

### Q: 为什么需要禁用缓存？
A: 开发和测试时，缓存可能导致看到旧版本的文件。`-c-1` 确保每次都加载最新内容。

### Q: 如何修改端口？
A: 编辑 `start-server.js`，将 `const PORT = 18980;` 改为其他端口号。

### Q: 端口被占用怎么办？
A: **无需担心！** 新的启动脚本会自动检测并清理占用端口的进程。只需运行 `npm run start` 即可。

### Q: 如何只在局域网访问？
A: 修改 `start-server.js` 中的 http-server 命令，添加 `-a 0.0.0.0` 参数。

### Q: 服务器启动后如何停止？
A: 在终端按 `Ctrl + C` 停止服务器。脚本会自动清理并释放端口。

### Q: 为什么 `Ctrl+C` 后端口还是被占用？（旧版问题）
A: **已解决！** 新版脚本在接收到 `Ctrl+C` 时会自动清理端口，无需手动处理。

### Q: Windows 下如何手动清理端口？（备用方案）
A: 如果遇到问题，可以手动执行：
```bash
# 查找占用端口的进程
netstat -ano | findstr :18980

# 强制结束进程（替换 <PID> 为实际进程 ID）
taskkill /F /PID <PID>
```

## 🚀 部署提示

生产环境建议：
- ✅ 使用 `npm run build` 构建
- ✅ 将 `publish/` 目录部署到服务器
- ✅ 配置服务器的缓存策略
- ✅ 启用 gzip/brotli 压缩
- ✅ 配置 CDN 加速

